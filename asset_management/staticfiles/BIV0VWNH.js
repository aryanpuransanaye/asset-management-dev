import{l as R,x as K,r as b,A as f,p as L,m as V,c as n,o,a as r,t as p,g as G,F as A,C as I,y as J,i as S,h as C,d as T,D as Q,j as W,k as X,E as Y}from"./BwLa1Iej.js";import{a as h}from"./bE3RgOHv.js";import{S as x}from"./BQxta0Da.js";import{u as Z}from"./DBTBYWdU.js";const ee={class:"mx-auto w-full min-h-screen bg-[#F0F5F9] dark:bg-gray-900",dir:"rtl"},te={class:"sm:w-4xl mx-auto bg-white dark:bg-gray-800 shadow-2xl rounded-2xl p-6 sm:p-8 text-right ring-1 ring-gray-100 dark:ring-gray-700/50 transition-colors"},ae={class:"mb-8 border-b border-blue-100 dark:border-blue-900 pb-4"},re={class:"flex items-center gap-4 text-2xl font-extrabold text-blue-600 dark:text-blue-400 justify-center"},se={key:0,class:"w-7 h-7 shrink-0 text-blue-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},oe={key:1,class:"w-7 h-7 shrink-0 text-green-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},le={class:"text-center"},ne={key:0,class:"flex flex-col items-center justify-center py-12"},ie={class:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-8"},ue={class:"block text-sm font-bold text-gray-700 dark:text-gray-200 mb-1"},de={key:0,class:"text-red-500"},ce=["onUpdate:modelValue","required","onChange","disabled"],ge={value:null,class:"text-gray-400 dark:text-gray-400"},be=["value"],pe=["onUpdate:modelValue","type","required","onInput"],ye={key:2,class:"text-red-600 dark:text-red-400 text-xs mt-1 animate-pulse font-bold"},me={class:"flex flex-wrap items-center justify-center gap-6 mt-10 pt-6 border-t border-gray-200 dark:border-gray-700"},ve=["disabled"],fe={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24"},he={__name:"AssetManagementCreateUpdate",props:{hardwareId:{type:[Number,String],default:null}},emits:["success","cancel"],setup(q,{emit:$}){const u=Z(),i=R(),c=K(),j=q,D=$,l=b({}),k=b([]),g=b({}),_=b(!0),y=b(!1),w=b(null),z=f(()=>j.hardwareId||i.params.id||i.query.id),m=f(()=>!!z.value),E=f(()=>m.value?"ویرایش اطلاعات":"ثبت مورد جدید"),v=f(()=>i.query.api),N=t=>t.key==="sub_organization"&&!l.value.organization?"ابتدا سازمان را انتخاب کنید...":"انتخاب کنید...",F=t=>{g.value[t]&&delete g.value[t],t==="organization"&&(l.value.sub_organization=null)},U=t=>t.key==="sub_organization"?l.value.organization?(t.options||[]).filter(a=>a.parent_id===l.value.organization):[]:t.options||[],H=t=>({IntegerField:"number",DateTimeField:"datetime-local",DateField:"date"})[t]||"text",M=async()=>{_.value=!0;try{const t=z.value,a=t?`${v.value}/${t}/`:`${v.value}/`,e=await h.get(a);k.value=e.data.config_form,l.value=e.data.result||{},w.value=e.data.category||{},k.value.forEach(s=>{s.key in l.value||(l.value[s.key]=null)})}catch(t){console.error("خطا در لود فرم:",t)}finally{_.value=!1}},O=async()=>{y.value=!0,g.value={};try{const t=z.value,a=t?`${v.value}/${t}/`:`${v.value}/`;let e={...l.value};Object.keys(e).forEach(d=>{(e[d]===null||e[d]===void 0||e[d]==="")&&delete e[d]});let s=null;if(m.value)if(i.query.api=="asset/scanned-asset"){s=await h.patch(a,e);const d=s.data.target_object_id;if(d){const B=w.value;await x.fire({icon:"success",title:"انجام شد",text:"با موفقیت در دسته بندی جدید قرار گرفت.",confirmButtonText:"عالی",background:u.value==="dark"?"#1e1e1e":"#fff",color:u.value==="dark"?"#fff":"#000"}),c.push({path:`/dashboard/asset-management/update/${d}`,query:{api:`asset/${B}`,id:d,isdevice_status:!0,modelname:B}})}}else await h.patch(a,e),await x.fire({icon:"success",title:"انجام شد",text:"با موفقیت ویرایش شد.",confirmButtonText:"عالی",background:u.value==="dark"?"#1e1e1e":"#fff",color:u.value==="dark"?"#fff":"#000"}),i.query.isdevice_status==="true"?c.push({path:"/dashboard/asset-management/data",query:{api:`asset/${i.query.modelname}`}}):c.back();else await h.post(a,e),await x.fire({icon:"success",title:"انجام شد",text:"با موفقیت اضافه شد.",confirmButtonText:"عالی",background:u.value==="dark"?"#1e1e1e":"#fff",color:u.value==="dark"?"#fff":"#000"}),c.back()}catch(t){t.response&&t.response.data&&(g.value=t.response.data,await x.fire({icon:"error",title:"انجام نشد",text:`خطایی رخ داده است ${t}`,confirmButtonText:"باشه",background:u.value==="dark"?"#1e1e1e":"#fff",color:u.value==="dark"?"#fff":"#000"}))}finally{y.value=!1}},P=()=>{D("cancel"),i.query.isdevice_status==="true"?c.push({path:"/dashboard/asset-management/data",query:{api:`asset/${i.query.modelname}`}}):c.back()};return L(M),V(()=>i.params.id,()=>{i.name==="CreateAssets"&&M()}),V(()=>l.value.category,t=>{t&&(w.value=t)}),(t,a)=>(o(),n("div",ee,[r("div",te,[r("div",ae,[r("h2",re,[m.value?(o(),n("svg",se,[...a[0]||(a[0]=[r("path",{d:"M21.731 2.269a2.68 2.68 0 00-3.792 0l-1.428 1.429 3.792 3.792 1.428-1.429a2.68 2.68 0 000-3.792zm-3.69 4.39l-2.094-2.094 1.429-1.429 2.094 2.094-1.429 1.429zM15 8.25V4.5A2.25 2.25 0 0012.75 2.25H5.25A2.25 2.25 0 003 4.5v15A2.25 2.25 0 005.25 21.75h10.5A2.25 2.25 0 0018 19.5v-3.75h-3zm-5.25 10.5a.75.75 0 01-1.5 0v-4.5a.75.75 0 011.5 0v4.5zm2.25 0a.75.75 0 01-1.5 0v-4.5a.75.75 0 011.5 0v4.5z"},null,-1)])])):(o(),n("svg",oe,[...a[1]||(a[1]=[r("path",{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 9a.75.75 0 00-1.5 0v2.25H9a.75.75 0 000 1.5h2.25V15a.75.75 0 001.5 0v-2.25H15a.75.75 0 000-1.5h-2.25V9z","clip-rule":"evenodd"},null,-1)])])),r("span",le,p(E.value),1)])]),_.value?(o(),n("div",ne,[...a[2]||(a[2]=[r("div",{class:"animate-spin rounded-full h-12 w-12 border-b-4 border-blue-600 dark:border-blue-400"},null,-1),r("p",{class:"mt-4 text-gray-500 dark:text-gray-400 text-sm font-medium"},"در حال بارگذاری اطلاعات...",-1)])])):(o(),n("form",{key:1,onSubmit:G(O,["prevent"]),class:"space-y-8"},[r("div",ie,[(o(!0),n(A,null,I(k.value,e=>(o(),n("div",{key:e.key,class:J([e.type==="TextField"?"md:col-span-2":"col-span-1","space-y-1"])},[r("label",ue,[T(p(e.label)+" ",1),e.required?(o(),n("span",de,"*")):C("",!0)]),e.type==="ChoiceField"||e.type==="ForeignKey"?S((o(),n("select",{key:0,"onUpdate:modelValue":s=>l.value[e.key]=s,class:"w-full h-11 px-4 py-2 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm font-medium transition-all duration-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/50 disabled:opacity-70 disabled:bg-gray-100 dark:disabled:bg-gray-800",required:e.required,onChange:s=>F(e.key),disabled:e.key==="sub_organization"&&!l.value.organization},[r("option",ge,p(N(e)),1),(o(!0),n(A,null,I(U(e),s=>(o(),n("option",{key:s.value,value:s.value,class:"text-gray-800 dark:text-gray-200"},p(s.label),9,be))),128))],40,ce)),[[Q,l.value[e.key]]]):S((o(),n("input",{key:1,"onUpdate:modelValue":s=>l.value[e.key]=s,type:H(e.type),class:"w-full h-11 px-4 py-2 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm font-medium transition-all duration-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/50 disabled:opacity-70 disabled:bg-gray-100 dark:disabled:bg-gray-800",required:e.required,onInput:s=>F(e.key)},null,40,pe)),[[W,l.value[e.key]]]),g.value[e.key]?(o(),n("p",ye,p(g.value[e.key][0]),1)):C("",!0)],2))),128))]),r("div",me,[r("button",{type:"submit",class:"inline-flex items-center px-8 py-3 bg-blue-600 text-white font-extrabold rounded-xl shadow-lg shadow-blue-500/40 hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 transition-all duration-200 disabled:bg-blue-400 dark:disabled:bg-blue-700 disabled:shadow-none",disabled:y.value},[y.value?(o(),n("svg",fe,[...a[3]||(a[3]=[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),r("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):C("",!0),T(" "+p(m.value?"بروزرسانی اطلاعات":"ذخیره رکورد جدید"),1)],8,ve),r("button",{type:"button",onClick:P,class:"px-6 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-bold rounded-xl hover:bg-gray-50 dark:hover:bg-gray-600 transition-all duration-200"}," انصراف ")])],32))])]))}},ze=X({__name:"create-update",setup(q){return($,u)=>(o(),Y(he))}});export{ze as _};
