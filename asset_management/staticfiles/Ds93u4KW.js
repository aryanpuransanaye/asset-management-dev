import{_ as ge}from"./Ay1NSG4u.js";import{_ as te,l as pe,x as be,r as v,A as _,B as X,m as Y,p as ye,c as n,o as s,h as i,a as t,b as ee,i as I,v as ve,F as w,C as A,D as xe,t as b,w as B,d as x,q as E,e as me,E as j,y as O,G as he}from"./BwLa1Iej.js";import{a as L}from"./bE3RgOHv.js";import{u as fe}from"./BBx8a8QP.js";import{S as R}from"./BQxta0Da.js";import{u as ke}from"./DBTBYWdU.js";import{u as _e}from"./BbYpKuGu.js";const we={class:"p-4 lg:p-6 bg-[#F0F5F9] dark:bg-gray-900 text-right min-h-screen mx-auto text-gray-900 dark:text-gray-100 transition-all duration-300",dir:"rtl"},Ce={key:0,class:"mb-5"},qe={class:"w-full"},$e={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 mb-6 p-4 lg:p-5"},Ae={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-5 gap-3"},Me={class:"md:col-span-2 relative"},Se=["placeholder"],Be=["onUpdate:modelValue"],Le={value:null},je=["value"],De={class:"flex flex-wrap justify-between items-center mt-6 pt-4 border-t border-gray-100 dark:border-gray-700 gap-3"},Te={key:0,class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-xl text-xs font-bold shadow-md transition-all flex items-center gap-2"},Ze={class:"flex flex-wrap gap-2"},Ee=["disabled"],Fe={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden"},Ve={class:"overflow-x-auto custom-scrollbar"},Ne={class:"w-full text-right border-collapse min-w-max"},Pe={class:"bg-gray-50 dark:bg-gray-900 sticky top-0 z-20"},Ue={class:"p-3 w-10 text-center"},He=["checked"],Ie=["onClick"],Oe={class:"flex items-center gap-1.5"},Re={key:0,class:"text-blue-600"},ze={key:0,class:"p-3 text-[11px] font-black text-gray-500 dark:text-gray-400 text-center sticky left-0 bg-gray-50 dark:bg-gray-900 border-r dark:border-gray-700"},Ke={class:"divide-y divide-gray-100 dark:divide-gray-700"},Ge={key:0},Je=["colspan"],Qe={class:"p-3 text-center"},We=["value"],Xe={class:"p-3 sticky left-0 bg-white dark:bg-gray-800 group-hover:bg-blue-50 dark:group-hover:bg-gray-700 transition-colors border-r dark:border-gray-700 text-center"},Ye={class:"flex justify-center gap-2"},et=["onClick"],tt={key:0},at=["colspan"],rt={class:"flex flex-col md:flex-row justify-between items-center mt-6 gap-4"},st={class:"text-[11px] text-gray-500 dark:text-gray-400 font-bold"},ot={class:"text-blue-600"},nt={class:"text-blue-600"},lt={key:0,class:"flex items-center gap-1",dir:"ltr"},dt=["disabled"],it={class:"flex gap-1 overflow-x-auto max-w-[200px] sm:max-w-none"},ut=["onClick"],ct=["disabled"],gt={__name:"AssetManagementAssetsList",props:{apiEndpoint:{type:String,default:""}},setup(z){const d=pe();be(),_e();const m=ke(),F=z,C=v([]),h=v([]),f=v([]),q=v(!1),k=v({display_names:{}}),ae=new Set(["q","id","created_at","updated_at"]),re=_(()=>{const r=k.value?.display_names||{};return Object.entries(r).filter(([e])=>!ae.has(e))}),p=v([]),M=v(1),K=v(0);let V=null;const o=X({page:1,q:"",sort_by:"-created_at"}),y=X({key:null,order:"asc"}),se=r=>r.replace(/\/\d+\/?$/,""),G=()=>d.query.api==="asset/scanned-asset"?`asset/scanned-asset/${d.query.asset_id}`:d.query.api||F.apiEndpoint,D=_(()=>G()),oe=_(()=>se(G())),$=async()=>{q.value=!0;try{const r={};Object.keys(o).forEach(c=>{o[c]!==null&&o[c]!==""&&(r[c]=o[c])});const e=await L.get(`${D.value}/list/`,{params:r});h.value=e.data.results||[],f.value=e.data.columns||[],M.value=e.data.total_pages||1,K.value=e.data.total_items||0}catch(r){console.error("Fetch error:",r)}finally{q.value=!1}},N=async()=>{try{const r=await L.get(`${D.value}/summary/`);C.value=Array.isArray(r.data)?r.data:r.data.summary_data||[]}catch{C.value=[]}},J=async()=>{try{const e=(await L.get(`${oe.value}/metadata/`)).data||{display_names:{}};k.value=e,e.display_names&&Object.keys(e.display_names).forEach(c=>{c in o||(o[c]=null)})}catch(r){console.error("Metadata error:",r)}},P=()=>{o.page=1,$()},Q=()=>{o.q="",Object.keys(o).forEach(r=>{["page","q"].includes(r)||(o[r]=null)}),o.sort_by="-created_at",y.key=null,o.page=1,$()},ne=r=>{y.order=y.key===r&&y.order==="asc"?"desc":"asc",y.key=r,o.sort_by=y.order==="desc"?`-${r}`:r,P()},U=r=>{o.page=r,$()},le=r=>{p.value=r.target.checked?h.value.map(e=>e.id):[]},de=_(()=>h.value.length>0&&p.value.length===h.value.length),W=async(r=null)=>{const e=r?[r]:p.value;if(!(!e.length||!(await R.fire({title:"حذف",text:"آیا از حذف مطمئن هستید؟",icon:"warning",showCancelButton:!0,confirmButtonText:"بله، حذف کن",cancelButtonText:"انصراف",reverseButtons:!0,background:m.value==="dark"?"#1e1e1e":"#fff",color:m.value==="dark"?"#fff":"#000"})).isConfirmed))try{await L.delete(`${D.value}/`,{data:{ids:e}}),p.value=[],$(),N(),await R.fire({icon:"success",title:"حذف شد",text:"آیتم(ها) با موفقیت حذف شدند",confirmButtonText:"باشه",background:m.value==="dark"?"#1e1e1e":"#fff",color:m.value==="dark"?"#fff":"#000"})}catch{await R.fire({icon:"error",title:"خطا",text:"خطا در عملیات حذف",confirmButtonText:"باشه",background:m.value==="dark"?"#1e1e1e":"#fff",color:m.value==="dark"?"#fff":"#000"})}},ie=async()=>{try{q.value=!0;const r={...o};delete r.page;const e=await L.get(`${D.value}/export/`,{params:r,responseType:"blob"}),c=window.URL.createObjectURL(new Blob([e.data])),g=document.createElement("a");g.href=c,g.setAttribute("download",`${ue.value}(${new Date().toLocaleDateString("fa-IR")}).xlsx`),g.click()}catch{alert("خطا در اکسل.")}finally{q.value=!1}},T=fe(),ue=_(()=>d.query.permission),S=_(()=>T.hasPermission(`accounts.asset_${d.query.permission}_crud`)||T.isAdmin),H=_(()=>T.hasPermission("accounts.can_use_scanners")||T.isAdmin),Z=()=>d.query.api==="asset/ip-manage",ce=()=>d.query.api==="asset/scanned-asset";return Y(()=>o.q,()=>{V&&clearTimeout(V),V=setTimeout(()=>P(),500)}),Y(()=>[F.apiEndpoint,d.query.api,d.query.permission],()=>{Q(),J(),$(),N()}),ye(()=>{J(),$(),N()}),(r,e)=>{const c=ge,g=me;return s(),n("div",we,[C.value&&C.value.length>0?(s(),n("div",Ce,[ee(c,{items:C.value},null,8,["items"])])):i("",!0),t("div",qe,[t("div",$e,[e[11]||(e[11]=t("div",{class:"flex items-center gap-2 mb-4 text-gray-700 dark:text-gray-200"},[t("i",{class:"bi bi-funnel-fill text-blue-600"}),t("span",{class:"font-bold text-sm"},"فیلترهای جستجو و عملیات")],-1)),t("div",Ae,[t("div",Me,[I(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>o.q=a),type:"text",class:"w-full pr-10 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none transition-all text-sm text-gray-900 dark:text-gray-100 placeholder-gray-400",placeholder:(k.value.display_names?.q||"جستجو...")+"..."},null,8,Se),[[ve,o.q]]),e[5]||(e[5]=t("div",{class:"absolute inset-y-0 right-3 flex items-center pointer-events-none text-gray-400"},[t("i",{class:"bi bi-search"})],-1))]),(s(!0),n(w,null,A(re.value,([a,u])=>(s(),n("div",{key:a,class:"relative group"},[I(t("select",{"onUpdate:modelValue":l=>o[a]=l,onChange:P,class:"w-full py-2 pr-3 pl-8 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-xl text-xs focus:ring-2 focus:ring-blue-500 outline-none appearance-none cursor-pointer transition-all text-gray-900 dark:text-gray-100"},[t("option",Le,b(u)+" (همه)",1),k.value[a]&&Array.isArray(k.value[a])?(s(!0),n(w,{key:0},A(k.value[a].filter(l=>l),l=>(s(),n("option",{key:l?.id||l?.value||l,value:l?.id!==void 0?l?.id:l?.value!==void 0?l?.value:l},b(l?.name||l?.label||l),9,je))),128)):i("",!0)],40,Be),[[xe,o[a]]]),e[6]||(e[6]=t("div",{class:"absolute inset-y-0 left-2.5 flex items-center pointer-events-none text-gray-400"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})])],-1))]))),128))]),t("div",De,[ee(g,{to:{path:"/dashboard/asset-management/create-update",query:{api:E(d).query.api}}},{default:B(()=>[S.value?(s(),n("button",Te,[...e[7]||(e[7]=[t("i",{class:"bi bi-plus-lg"},null,-1),x(" افزودن رکورد جدید ",-1)])])):i("",!0)]),_:1},8,["to"]),t("div",Ze,[ce()&&H.value?(s(),j(g,{key:0,to:{path:`/dashboard/asset-management/scan/${E(d).query.asset_id}`,query:{asset_id:E(d).query.asset_id}}},{default:B(()=>[...e[8]||(e[8]=[t("button",{class:"bg-white dark:bg-gray-800 hover:bg-emerald-50 dark:hover:bg-gray-700 text-blue-600 border border-blue-200 dark:border-blue-900/40 px-4 py-2 rounded-xl text-xs font-bold transition-all flex items-center gap-2"},[t("i",{class:"bi bi-file-earmark-excel-fill"}),x(" اسکن ")],-1)])]),_:1},8,["to"])):i("",!0),S.value&&p.value.length>0?(s(),n("button",{key:1,onClick:e[1]||(e[1]=a=>W()),class:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-xl text-xs font-bold shadow-md transition-all flex items-center gap-2"},[e[9]||(e[9]=t("i",{class:"bi bi-trash-fill"},null,-1)),x(" حذف ("+b(p.value.length)+") ",1)])):i("",!0),Z()===!1?(s(),n("button",{key:2,onClick:ie,disabled:q.value,class:"bg-white dark:bg-gray-800 hover:bg-emerald-50 dark:hover:bg-gray-700 text-emerald-600 border border-emerald-200 dark:border-emerald-900/40 px-4 py-2 rounded-xl text-xs font-bold transition-all flex items-center gap-2"},[...e[10]||(e[10]=[t("i",{class:"bi bi-file-earmark-excel-fill"},null,-1),x(" اکسل ",-1)])],8,Ee)):i("",!0),t("button",{onClick:Q,class:"bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-300 border border-gray-200 dark:border-gray-700 px-4 py-2 rounded-xl text-xs font-bold transition-all"}," پاکسازی ")])])]),t("div",Fe,[t("div",Ve,[t("table",Ne,[t("thead",Pe,[t("tr",null,[t("th",Ue,[t("input",{type:"checkbox",class:"w-4 h-4 rounded text-blue-600 cursor-pointer",checked:de.value,onChange:le},null,40,He)]),(s(!0),n(w,null,A(f.value.filter(a=>a.key!=="id"),a=>(s(),n("th",{key:a.key,onClick:u=>ne(a.key),class:"p-3 text-[11px] font-black text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"},[t("div",Oe,[x(b(k.value.display_names?.[a.key]||a.label||a.key)+" ",1),y.key===a.key?(s(),n("span",Re,[t("i",{class:O(y.order==="asc"?"bi bi-sort-up":"bi bi-sort-down")},null,2)])):i("",!0)])],8,Ie))),128)),H.value||S.value||Z()?(s(),n("th",ze,"عملیات")):i("",!0)])]),t("tbody",Ke,[q.value?(s(),n("tr",Ge,[t("td",{colspan:f.value.length+2,class:"p-16 text-center"},[...e[12]||(e[12]=[t("div",{class:"animate-spin inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mb-4"},null,-1),t("div",{class:"text-blue-600 font-bold text-sm"},"در حال بروزرسانی لیست...",-1)])],8,Je)])):(s(),n(w,{key:1},[(s(!0),n(w,null,A(h.value,a=>(s(),n("tr",{key:a.id,class:O(["hover:bg-blue-50/30 dark:hover:bg-gray-700/30 transition-colors group",{"bg-blue-50/50 dark:bg-blue-900/10":p.value.includes(a.id)}])},[t("td",Qe,[I(t("input",{type:"checkbox",class:"w-4 h-4 rounded text-blue-600 cursor-pointer",value:a.id,"onUpdate:modelValue":e[2]||(e[2]=u=>p.value=u)},null,8,We),[[he,p.value]])]),(s(!0),n(w,null,A(f.value.filter(u=>u.key!=="id"),u=>(s(),n("td",{key:u.key,class:"p-3 text-xs text-gray-600 dark:text-gray-300 whitespace-nowrap"},b(a[u.key]!=null&&String(a[u.key]).toLowerCase()!=="none"?a[u.key]:"-"),1))),128)),t("td",Xe,[t("div",Ye,[S.value?(s(),j(g,{key:0,to:{path:`/dashboard/asset-management/update/${a.id}`,query:{api:E(d).query.api}}},{default:B(()=>[...e[13]||(e[13]=[t("button",{class:"text-blue-600 hover:bg-blue-100 p-1.5 rounded-lg transition-colors"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.8",stroke:"currentColor",class:"w-4 h-4"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})])],-1)])]),_:1},8,["to"])):i("",!0),S.value?(s(),n("button",{key:1,onClick:u=>W(a.id),class:"text-red-500 hover:bg-red-100 p-1.5 rounded-lg transition-colors"},[...e[14]||(e[14]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.8",stroke:"currentColor",class:"w-4 h-4"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})],-1)])],8,et)):i("",!0),Z()&&H.value?(s(),j(g,{key:2,to:{path:`/dashboard/asset-management/scan/${a.id}`,query:{asset_id:a.id}}},{default:B(()=>[...e[15]||(e[15]=[t("button",{class:"text-green-600 hover:bg-green-100 p-1.5 rounded-lg transition-colors"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-4 h-4"},[t("path",{"fill-rule":"evenodd",d:"M1.5 10.5a3 3 0 0 1 3-3h15a3 3 0 1 1 0 6h-15a3 3 0 0 1-3-3Zm15 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Zm2.25.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM4.5 15a3 3 0 1 0 0 6h15a3 3 0 1 0 0-6h-15Zm11.25 3.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM19.5 18a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z","clip-rule":"evenodd"})])],-1)])]),_:1},8,["to"])):i("",!0),Z()?(s(),j(g,{key:3,to:{path:"/dashboard/asset-management/data",query:{api:"asset/scanned-asset",asset_id:a.id}}},{default:B(()=>[...e[16]||(e[16]=[t("button",{class:"text-purple-600 hover:bg-purple-100 p-1.5 rounded-lg transition-colors"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.8",stroke:"currentColor",class:"w-4 h-4"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])],-1)])]),_:1},8,["to"])):i("",!0)])])],2))),128)),h.value.length===0?(s(),n("tr",tt,[t("td",{colspan:f.value.length+2,class:"p-12 text-center text-gray-400 dark:text-gray-500 text-sm italic"}," اطلاعاتی برای نمایش یافت نشد. ",8,at)])):i("",!0)],64))])])])]),t("div",rt,[t("div",st,[e[17]||(e[17]=x(" نمایش صفحه ",-1)),t("span",ot,b(o.page),1),e[18]||(e[18]=x(" از ",-1)),t("span",nt,b(M.value),1),e[19]||(e[19]=t("span",{class:"mx-2"},"|",-1)),x(" کل رکوردها: "+b(K.value),1)]),M.value>1?(s(),n("nav",lt,[t("button",{onClick:e[3]||(e[3]=a=>U(o.page-1)),disabled:o.page===1,class:"px-3 py-1.5 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg text-xs hover:bg-gray-50 disabled:opacity-40 transition-all"},[...e[20]||(e[20]=[t("i",{class:"bi bi-chevron-left"},null,-1)])],8,dt),t("div",it,[(s(!0),n(w,null,A(M.value,a=>(s(),n("button",{key:a,onClick:u=>U(a),class:O([a===o.page?"bg-blue-600 text-white border-blue-600 shadow-sm":"bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-200 border-gray-200 dark:border-gray-700","min-w-[32px] h-8 border rounded-lg text-xs hover:bg-gray-50 transition-all font-black"])},b(a),11,ut))),128))]),t("button",{onClick:e[4]||(e[4]=a=>U(o.page+1)),disabled:o.page===M.value,class:"px-3 py-1.5 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg text-xs hover:bg-gray-50 disabled:opacity-40 transition-all"},[...e[21]||(e[21]=[t("i",{class:"bi bi-chevron-right"},null,-1)])],8,ct)])):i("",!0)])])])}}},pt=te(gt,[["__scopeId","data-v-9af21c83"]]),bt={};function yt(z,d,m,F,C,h){const f=pt;return s(),j(f)}const wt=te(bt,[["render",yt]]);export{wt as default};
