import{J as e,n as i}from"./BwLa1Iej.js";import{a}from"./bE3RgOHv.js";const l=e("scan",{state:()=>({polling:!1,scanStatus:null,error:null,asset_id:null,timer:null,STATUS_CHOICES:{running:"در حال اجرا",finished:"تکمیل شده",failed:"ناموفق",no_new_ip:"IP جدیدی یافت نشد",canceled:"کنسل شده"}}),getters:{scanStatusLabel:t=>t.STATUS_CHOICES[t.scanStatus]||""},actions:{async startScan(t){if(!(this.polling||this.scanStatus==="running"))try{await a.post(`asset/scan-manualy/${t}/`),this.startPolling(t)}catch(s){console.error("خطا در شروع اسکن:",s),this.error="خطا در شروع اسکن. دوباره تلاش کنید."}},startPolling(t){this.polling||(this.asset_id=t,this.polling=!0,this.scanStatus="running",this.error=null,this.checkScanStatus())},stopPolling(){this.polling=!1,clearTimeout(this.timer),this.timer=null},async cancelScan(){if(this.polling)try{await a.delete(`asset/scan-manualy/${this.asset_id}/`),this.stopPolling(),this.scanStatus="canceled",this.error=this.STATUS_CHOICES.canceled}catch(t){console.error(t),this.error="خطا در کنسل کردن اسکن."}},async checkScanStatus(){if(this.polling)try{const s=(await a.get(`asset/scan-manualy/${this.asset_id}/`)).data.status;if(this.scanStatus=s,s==="finished"||s==="failed"||s==="no_new_ip"){this.stopPolling(),await i({path:"/dashboard/asset-management/data",query:{api:"asset/scanned-asset",asset_id:this.asset_id}});return}if(s==="canceled"){this.stopPolling(),this.error=this.STATUS_CHOICES.canceled;return}this.timer=setTimeout(()=>this.checkScanStatus(),3e3)}catch(t){console.error(t),this.error="ارتباط با سرور قطع شد. تلاش مجدد...",this.timer=setTimeout(()=>this.checkScanStatus(),5e3)}}}});export{l as u};
